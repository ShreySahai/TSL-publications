<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publication Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .publication {
            margin-bottom: 20px;
        }
        .publication-details {
            margin-left: 20px;
        }
        .publication button {
            margin-top: 10px;
        }
        #downloadButton {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #downloadButton:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <h1>Manage Publications</h1>
    <div id="publication-list"></div>

    <button id="downloadButton" onclick="downloadJson()">Download Modified JSON</button>

    <script>
        let publications = []; // This will hold the JSON data

        // Fetch JSON file from a URL (replace the URL with the actual location of your JSON file)
        fetch('/publications.json')
            .then(response => response.json())
            .then(data => {
                publications = data; // Store fetched data in the publications array
                displayPublications(); // Call function to display publications
            })
            .catch(error => {
                console.error('Error fetching JSON:', error);
            });

        // Function to display publications
        function displayPublications() {
            const listContainer = document.getElementById('publication-list');
            listContainer.innerHTML = ''; // Clear any existing publications

            publications.forEach((pub, index) => {
                const pubDiv = document.createElement('div');
                pubDiv.classList.add('publication');

                // Publication details
                const title = document.createElement('h3');
                title.innerText = pub.bib.title;
                pubDiv.appendChild(title);

                const author = document.createElement('p');
                author.innerText = 'Author(s): ' + pub.bib.author;
                pubDiv.appendChild(author);

                const year = document.createElement('p');
                year.innerText = 'Year: ' + pub.bib.pub_year;
                pubDiv.appendChild(year);

                const venue = document.createElement('p');
                venue.innerText = 'Venue: ' + pub.bib.venue;
                pubDiv.appendChild(venue);

                // Checkbox for deleting publication
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = 'delete_' + index;
                pubDiv.appendChild(checkbox);

                const label = document.createElement('label');
                label.setAttribute('for', 'delete_' + index);
                label.innerText = 'Delete this publication';
                pubDiv.appendChild(label);

                listContainer.appendChild(pubDiv);
            });
        }

        // Function to delete selected publications
        function deleteSelectedPublications() {
            publications = publications.filter((pub, index) => {
                const checkbox = document.getElementById('delete_' + index);
                return !checkbox.checked;
            });
        }

        // Function to download modified JSON
        function downloadJson() {
            // Delete selected publications before downloading
            deleteSelectedPublications();

            // Convert the modified publications array to a JSON string
            const jsonString = JSON.stringify(publications, null, 2);

            // Create a Blob with the JSON string
            const blob = new Blob([jsonString], { type: 'application/json' });

            // Create a link element
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'modified_publications.json';  // Specify the filename

            // Trigger the download
            link.click();
        }
    </script>

</body>
</html>
